<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paiho Elite Shoelace Adventure</title>
    <style>
        :root {
            --paiho-red: #e60012;
            --shoe-fabric: #243441;
            --btn-base: #2c3e50;
            --btn-shadow: #16212b;
            --btn-light: #425d78;
        }
        body {
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
            height: 100vh; margin: 0; background: #0f171e; color: white; overflow: hidden; font-family: sans-serif;
        }
        .header { padding: 20px 0 10px; text-align: center; width: 100%; }
        .logo { font-size: 24px; font-weight: 900; letter-spacing: 3px; }
        .logo span { color: var(--paiho-red); }
        .status-bar { display: flex; justify-content: center; gap: 12px; margin-top: 10px; }
        .badge { background: rgba(255,255,255,0.05); padding: 6px 16px; border-radius: 12px; border: 1px solid rgba(230,0,18,0.3); font-size: 13px; }
        #game-area { flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
        canvas { border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); background-color: var(--shoe-fabric); }
        
        .controls { display: grid; grid-template-columns: repeat(3, 75px); gap: 18px; padding-bottom: 40px; }
        .joy-btn {
            width: 75px; height: 75px; background: var(--btn-base); border: none; border-radius: 22px;
            color: #fff; font-size: 28px; cursor: pointer;
            box-shadow: 8px 8px 16px var(--btn-shadow), -6px -6px 12px var(--btn-light);
            display: flex; align-items: center; justify-content: center; transition: 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .joy-btn:active {
            box-shadow: inset 6px 6px 12px var(--btn-shadow), inset -4px -4px 10px var(--btn-light);
            transform: scale(0.94); color: var(--paiho-red);
        }
        .up { grid-column: 2; } .left { grid-column: 1; } .right { grid-column: 3; } .down { grid-column: 2; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">PAIHO <span>ELITE</span></div>
        <div class="status-bar">
            <div class="badge">得分: <span id="score">0</span></div>
            <div class="badge">動作: <span id="mode" style="color:var(--paiho-red)">READY</span></div>
        </div>
    </div>

    <div id="game-area">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="controls">
        <button class="joy-btn up" onclick="handleInput(0,-1)">▲</button>
        <button class="joy-btn left" onclick="handleInput(-1,0)">◀</button>
        <button class="joy-btn right" onclick="handleInput(1,0)">▶</button>
        <button class="joy-btn down" onclick="handleInput(0,1)">▼</button>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const modeEl = document.getElementById("mode");

    const size = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.45);
    canvas.width = size; canvas.height = size;
    const grid = 15, ts = canvas.width / grid;

    let snake = [{x: 7, y: 11}, {x: 7, y: 12}, {x: 7, y: 13}];
    let eyelet = {x: 7, y: 4};
    let dx = 0, dy = -1, score = 0, count = 0;
    let particles = [];
    
    // 載入素材
    const laceImg = new Image();
    laceImg.src = 'https://material.paiho.com/upload/BRD2147-J01F.jpg';
    const eyeletImg = new Image();
    eyeletImg.src = 'https://img.cloudimg.in/uploads/shops/7834/products/c0/c0d603bcac41967fd88028e08236541b.jpg';

    function handleInput(x, y) {
        if ((x === -dx && x !== 0) || (y === -dy && y !== 0)) return;
        dx = x; dy = y;
    }

    function createParticles(x, y, type) {
        for(let i=0; i<25; i++) {
            const angle = Math.random() * Math.PI * 2;
            const dist = type === 'in' ? 50 : 0;
            particles.push({
                x: x + Math.cos(angle) * dist,
                y: y + Math.sin(angle) * dist,
                vx: type === 'in' ? 0 : (Math.random() - 0.5) * 12,
                vy: type === 'in' ? 0 : (Math.random() - 0.5) * 12,
                targetX: x, targetY: y,
                life: 1, type: type
            });
        }
    }

    function update() {
        if (dx === 0 && dy === 0) return;
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};
        
        if (head.x === eyelet.x && head.y === eyelet.y) {
            score++; count++;
            scoreEl.innerText = score;
            const type = count % 2 === 1 ? 'in' : 'out';
            modeEl.innerText = type === 'in' ? "鑽入 ↓" : "鑽出 ↑";
            createParticles(eyelet.x * ts + ts/2, eyelet.y * ts + ts/2, type);
            spawnEyelet();
        } else {
            snake.pop();
        }
        snake.unshift(head);

        particles.forEach((p, i) => {
            if (p.type === 'in') {
                p.x += (p.targetX - p.x) * 0.2;
                p.y += (p.targetY - p.y) * 0.2;
            } else {
                p.x += p.vx; p.y += p.vy;
            }
            p.life -= 0.04;
            if (p.life <= 0) particles.splice(i, 1);
        });
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 畫鞋眼孔 (使用圖片)
        if (eyeletImg.complete) {
            ctx.drawImage(eyeletImg, eyelet.x * ts, eyelet.y * ts, ts, ts);
        } else {
            ctx.fillStyle = "#000";
            ctx.beginPath(); ctx.arc(eyelet.x*ts+ts/2, eyelet.y*ts+ts/2, ts/2.5, 0, Math.PI*2); ctx.fill();
        }

        // 畫織帶 (Snake)
        snake.forEach((p, i) => {
            ctx.save();
            const isHead = i === 0;
            let scale = 1, alpha = 1;
            
            if (isHead && score > 0) {
                scale = (count % 2 === 1) ? 0.5 : 1.5;
                alpha = (count % 2 === 1) ? 0.4 : 1;
            }
            
            ctx.translate(p.x * ts + ts/2, p.y * ts + ts/2);
            ctx.scale(scale, scale);
            ctx.globalAlpha = alpha;

            if (laceImg.complete) {
                // 從織帶圖片中心截取方塊
                const crop = 350;
                ctx.drawImage(laceImg, (laceImg.width-crop)/2, (laceImg.height-crop)/2, crop, crop, -ts/2, -ts/2, ts, ts);
            } else {
                ctx.fillStyle = var(--paiho-red); ctx.fillRect(-ts/2, -ts/2, ts, ts);
            }
            ctx.restore();
        });

        // 畫粒子
        particles.forEach(p => {
            ctx.fillStyle = `rgba(230, 0, 18, ${p.life})`;
            ctx.beginPath(); ctx.arc(p.x, p.y, 4 * p.life, 0, Math.PI*2); ctx.fill();
        });
    }

    function spawnEyelet() {
        eyelet = {x: Math.floor(Math.random()*grid), y: Math.floor(Math.random()*grid)};
        if (snake.some(p => p.x === eyelet.x && p.y === eyelet.y)) spawnEyelet();
    }

    function checkHit() {
        const h = snake[0];
        return h.x<0 || h.x>=grid || h.y<0 || h.y>=grid || snake.slice(1).some(p => p.x === h.x && p.y === h.y);
    }

    let lastTick = 0;
    function main(t) {
        requestAnimationFrame(main);
        if (t - lastTick < 220) return;
        lastTick = t;
        if (checkHit()) { alert("遊戲結束！穿孔得分: " + score); restart(); return; }
        update(); draw();
    }

    function restart() {
        score = 0; count = 0; dx = 0; dy = -1;
        snake = [{x: 7, y: 11}, {x: 7, y: 12}, {x: 7, y: 13}];
        spawnEyelet();
    }

    spawnEyelet();
    requestAnimationFrame(main);
</script>
</body>
</html>
