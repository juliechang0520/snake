<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鞋帶穿孔邏輯遊戲</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #121212; display: flex; flex-col; align-items: center; justify-content: center; min-h-screen; color: white; }
        canvas { background: #222; border: 4px solid #444; border-radius: 12px; box-shadow: 0 0 40px rgba(0,0,0,0.8); }
        .ui-panel { margin-bottom: 20px; text-align: center; }
        .mode-indicator { padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; }
        .mode-player { background: #ef4444; color: white; }
        .mode-auto { background: #3b82f6; color: white; }
    </style>
</head>
<body>

    <div class="ui-panel">
        <div class="text-4xl font-black mb-2 italic">HOLES: <span id="score">0</span></div>
        <div id="status" class="mode-indicator mode-player">玩家控制中</div>
    </div>

    <canvas id="gameCanvas" width="600" height="600"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score");
        const statusElement = document.getElementById("status");

        // 參數設定 (2倍大)
        const box = 40; 
        const eyeletRadius = 18;
        const laceWidth = 32;
        let score = 0;
        let gameSpeed = 150;

        // 狀態管理
        let isAutoMode = false;
        let snake = [{ x: 7 * box, y: 7 * box }];
        let d = "RIGHT";
        let targetHole = { x: 3 * box, y: 3 * box };
        let pathHistory = []; // 紀錄地表上的路徑點用於碰撞判定

        // 1. 繪製金屬鞋孔 (Eyelet)
        function drawEyelet(x, y) {
            const cx = x + box/2;
            const cy = y + box/2;
            
            ctx.save();
            let grad = ctx.createRadialGradient(cx-5, cy-5, 2, cx, cy, eyeletRadius);
            grad.addColorStop(0, "#ffffff");
            grad.addColorStop(0.5, "#999");
            grad.addColorStop(1, "#333");
            
            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.arc(cx, cy, eyeletRadius, 0, Math.PI * 2);
            ctx.fill();

            // 孔洞中心
            ctx.fillStyle = "#111";
            ctx.beginPath();
            ctx.arc(cx, cy, eyeletRadius - 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        // 2. 繪製垂直水平編織鞋帶 (Woven Lace)
        function drawLace(x, y, opacity = 1) {
            ctx.save();
            ctx.globalAlpha = opacity;
            
            // 白色基底
            ctx.fillStyle = "#eee";
            ctx.beginPath();
            ctx.roundRect(x + 4, y + 4, box - 8, box - 8, 4);
            ctx.fill();

            // 垂直水平編織紋 (十字)
            ctx.strokeStyle = "#d32f2f";
            ctx.lineWidth = 4;
            
            // 水平線
            ctx.beginPath();
            ctx.moveTo(x + 4, y + box/2);
            ctx.lineTo(x + box - 4, y + box/2);
            ctx.stroke();

            // 垂直線
            ctx.beginPath();
            ctx.moveTo(x + box/2, y + 4);
            ctx.lineTo(x + box/2, y + box - 4);
            ctx.stroke();
            
            ctx.restore();
        }

        function changeDir(newDir) {
            if (isAutoMode) return; // 自動模式禁用控制
            if (newDir == "LEFT" && d != "RIGHT") d = "LEFT";
            else if (newDir == "UP" && d != "DOWN") d = "UP";
            else if (newDir == "RIGHT" && d != "LEFT") d = "RIGHT";
            else if (newDir == "DOWN" && d != "UP") d = "DOWN";
        }

        window.addEventListener("keydown", (e) => {
            if (e.keyCode == 37) changeDir("LEFT");
            if (e.keyCode == 38) changeDir("UP");
            if (e.keyCode == 39) changeDir("RIGHT");
            if (e.keyCode == 40) changeDir("DOWN
