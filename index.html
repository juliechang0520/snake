<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paiho Shoelace Elite</title>
    <style>
        :root {
            --paiho-red: #e60012;
            --paiho-dark-red: #80000a;
            --paiho-light-red: #ff4d4d;
            --paiho-black: #121212;
            --paiho-white: #ffffff;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 100vh;
            margin: 0;
            background-color: var(--paiho-black);
            font-family: -apple-system, "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            color: var(--paiho-white);
            overflow: hidden;
        }

        /* 頂部 App Bar 質感 */
        .app-bar {
            width: 100%;
            padding: 20px 0;
            background: linear-gradient(180deg, #1f1f1f 0%, var(--paiho-black) 100%);
            text-align: center;
            border-bottom: 2px solid var(--paiho-red);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .brand {
            font-size: 26px;
            font-weight: 900;
            letter-spacing: 4px;
            text-shadow: 0 0 10px rgba(230, 0, 18, 0.3);
        }

        .brand span { color: var(--paiho-red); }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 12px;
        }

        .badge {
            background: var(--glass);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(5px);
        }

        /* 遊戲畫布區域 */
        #stage {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 10px;
        }

        canvas {
            background-color: var(--paiho-white);
            border-radius: 16px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6);
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* 虛擬搖桿優化 */
        .controller {
            padding-bottom: 40px;
            display: grid;
            grid-template-columns: repeat(3, 75px);
            gap: 15px;
        }

        .key {
            width: 75px;
            height: 75px;
            background: var(--glass);
            border: 2px solid var(--paiho-red);
            border-radius: 20px;
            color: var(--paiho-red);
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 0 rgba(230, 0, 18, 0.2);
        }

        .key:active {
            background: var(--paiho-red);
            color: white;
            transform: translateY(4px) scale(0.95);
            box-shadow: 0 0 0 transparent;
        }

        .up { grid-column: 2; }
        .left { grid-column: 1; }
        .down { grid-column: 2; }
        .right { grid-column: 3; }

        #mode-display {
            font-weight: bold;
            transition: all 0.3s;
        }
    </style>
</head>
<body>

    <div class="app-bar">
        <div class="brand">PAIHO <span>TAIWAN</span></div>
        <div class="stats-row">
            <div class="badge">SCORE: <span id="score">0</span></div>
            <div class="badge">MODE: <span id="mode-display">READY</span></div>
        </div>
    </div>

    <div id="stage">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="controller">
        <button class="key up" onclick="handleInput(0, -1)">↑</button>
        <button class="key left" onclick="handleInput(-1, 0)">←</button>
        <button class="key down" onclick="handleInput(0, 1)">↓</button>
        <button class="key right" onclick="handleInput(1, 0)">→</button>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreText = document.getElementById("score");
    const modeText = document.getElementById("mode-display");

    // 響應式螢幕適應
    const size = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.45);
    canvas.width = size;
    canvas.height = size;

    const gridNum = 15;
    const unit = canvas.width / gridNum;

    let snake = [{x: 7, y: 7}, {x: 7, y: 8}, {x: 7, y: 9}];
    let eyelet = {x: 5, y: 5};
    let moveX = 0, moveY = 0, points = 0, stepCount = 0;
    let frameRate = 0;
    const gameSpeed = 200; // 調整後的適中速度

    // 動態視覺參數
    let headScale = 1;
    let headColor = "#e60012";

    function loop(now) {
        requestAnimationFrame(loop);
        if (now - frameRate < gameSpeed) return;
        frameRate = now;

        if (isDead()) {
            alert("遊戲結束！穿孔得分：" + points);
            restart();
            return;
        }
        process();
        render();
    }

    function process() {
        if (moveX === 0 && moveY === 0) return;

        const nextHead = {x: snake[0].x + moveX, y: snake[0].y + moveY};
        snake.unshift(nextHead);

        if (nextHead.x === eyelet.x && nextHead.y === eyelet.y) {
            points++;
            stepCount++;
            scoreText.innerText = points;
            
            // 明確的動態區分邏輯
            if (stepCount % 2 === 1) {
                // 由上往下：鑽入感（變小、變深）
                modeText.innerText = "TOP-DOWN ↓";
                modeText.style.color = "#ff8080";
                headScale = 0.6;
                headColor = "var(--paiho-dark-red)";
            } else {
                // 由下往上：鑽出感（變大、變亮）
                modeText.innerText = "BOTTOM-UP ↑";
                modeText.style.color = "var(--paiho-light-red)";
                headScale = 1.4;
                headColor = "var(--paiho-light-red)";
            }

            // 畫布震動特效
            canvas.style.transform = "scale(1.03)";
            setTimeout(() => canvas.style.transform = "scale(1)", 100);
            
            dropEyelet();
        } else {
            snake.pop();
            // 平時恢復標準鞋帶狀態
            headScale = 1;
            headColor = "var(--paiho-red)";
        }
    }

    function render() {
        // 清除並畫背景
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 畫輕微背景格線
        ctx.strokeStyle = "#f0f0f0";
        ctx.lineWidth = 1;
        for(let i=0; i<=gridNum; i++) {
            ctx.beginPath(); ctx.moveTo(i*unit, 0); ctx.lineTo(i*unit, canvas.height); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0, i*unit); ctx.lineTo(canvas.width, i*unit); ctx.stroke();
        }

        // 畫鞋眼孔 (Eyelet) - 金屬立體感
        const ex = eyelet.x * unit + unit/2;
        const ey = eyelet.y * unit + unit/2;
        let ring = ctx.createRadialGradient(ex-2, ey-2, 1, ex, ey, unit/2.5);
        ring.addColorStop(0, "#444");
        ring.addColorStop(1, "#000");
        ctx.fillStyle = ring;
        ctx.beginPath();
        ctx.arc(ex, ey, unit/2.5, 0, Math.PI*2);
        ctx.fill();

        // 畫鞋帶 (Shoelace Snake)
        snake.forEach((node, idx) => {
            const isHead = idx === 0;
            const s = isHead ? headScale : 1;
            const color = isHead ? headColor : "var(--paiho-red)";
            const gap = (unit * (1 - s)) / 2;

            // 建立鞋帶立體漸層
            let grad = ctx.createLinearGradient(node.x*unit, node.y*unit, (node.x+1)*unit, (node.y+1)*unit);
            grad.addColorStop(0, color);
            grad.addColorStop(1, isHead ? "#600000" : "var(--paiho-dark-red)");

            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.roundRect(
                node.x*unit + 1 + gap, 
                node.y*unit + 1 + gap, 
                (unit-2) * s, 
                (unit-2) * s, 
                isHead ? 8 : 4
            );
            ctx.fill();

            // 增加織帶表面紋理
            ctx.strokeStyle = "rgba(255,255,255,0.1)";
            ctx.stroke();
        });
    }

    function handleInput(x, y) {
        if ((x === -moveX && x !== 0) || (y === -moveY && y !== 0)) return;
        moveX = x; moveY = y;
    }

    function isDead() {
        const h = snake[0];
        if (h.x<0 || h.x>=gridNum || h.y<0 || h.y>=gridNum) return true;
        for (let i=1; i<snake.length; i++) {
            if (snake[i].x === h.x && snake[i].y === h.y) return true;
        }
        return false;
    }

    function dropEyelet() {
        eyelet = {x: Math.floor(Math.random()*gridNum), y: Math.floor(Math.random()*gridNum)};
        // 避免生在蛇身上
        if (snake.some(p => p.x === eyelet.x && p.y === eyelet.y)) dropEyelet();
    }

    function restart() {
        points = 0; moveX = 0; moveY = 0; stepCount = 0;
        snake = [{x: 7, y: 7}, {x: 7, y: 8}, {x: 7, y: 9}];
        scoreText.innerText = "0";
        modeText.innerText = "READY";
        modeText.style.color = "var(--paiho-white)";
        dropEyelet();
    }

    dropEyelet();
    requestAnimationFrame(loop);
</script>
</body>
</html>
