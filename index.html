<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PAIHO Elite - Adventure</title>
    <style>
        :root {
            --paiho-red: #e60012;
            --bg-dark: #f4f4f4;
            --canvas-bg: #34495e;
            --btn-base: #ecf0f1;
        }
        body, html {
            height: 100%; margin: 0; padding: 0;
            background: var(--bg-dark); color: #333; overflow: hidden;
            display: flex; flex-direction: column; font-family: 'Segoe UI', sans-serif;
        }

        /* 頂部區域 (10%) */
        .header {
            height: 12%; display: flex; flex-direction: column;
            justify-content: center; align-items: center; background: #222; color: white;
        }
        .logo { font-size: 24px; font-weight: 900; letter-spacing: 2px; }
        .logo i { color: var(--paiho-red); font-style: normal; }
        .stats { display: flex; gap: 15px; margin-top: 5px; }
        .pill { background: rgba(255,255,255,0.1); padding: 4px 15px; border-radius: 20px; font-size: 12px; border: 1px solid var(--paiho-red); }

        /* 遊戲畫布區 (65%) */
        #stage {
            height: 65%; width: 100%; display: flex; align-items: center; justify-content: center; padding: 10px; box-sizing: border-box;
        }
        canvas {
            background-color: var(--canvas-bg);
            background-image: radial-gradient(#2c3e50 1px, transparent 1px);
            background-size: 20px 20px;
            border-radius: 30px; 
            box-shadow: 0 30px 60px rgba(0,0,0,0.3);
            max-width: 100%; max-height: 100%;
            transition: transform 0.1s ease;
        }

        /* 下方控制區 (23%) */
        .controls {
            height: 23%; width: 100%; display: grid;
            grid-template-columns: repeat(4, 1fr); gap: 10px;
            padding: 15px; box-sizing: border-box; background: white;
        }
        .btn {
            background: #e0e5ec; border: none; border-radius: 15px;
            box-shadow: 6px 6px 12px #a3b1c6, -6px -6px 12px #ffffff;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: #444; transition: 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active {
            box-shadow: inset 4px 4px 8px #a3b1c6, inset -4px -4px 8px #ffffff;
            transform: scale(0.92); color: var(--paiho-red);
        }
        .up { grid-column: 2; }
        .down { grid-column: 2; grid-row: 2; }
        .left { grid-column: 1; grid-row: 1; }
        .right { grid-column: 3; grid-row: 1; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">PAIHO <i>Elite</i></div>
        <div class="stats">
            <div class="pill">SCORE: <b id="score">0</b></div>
            <div class="pill">ACTION: <b id="action" style="color:var(--paiho-red)">READY</b></div>
        </div>
    </div>

    <div id="stage">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="controls">
        <button class="btn left" onclick="move(-1,0)">◀</button>
        <button class="btn up" onclick="move(0,-1)">▲</button>
        <button class="btn right" onclick="move(1,0)">▶</button>
        <button class="btn down" onclick="move(0,1)">▼</button>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const actionEl = document.getElementById("action");

    const size = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.5);
    canvas.width = size; canvas.height = size;
    const grid = 14, ts = canvas.width / grid;

    let snake = [{x: 7, y: 10}, {x: 7, y: 11}, {x: 7, y: 12}];
    let eyelet = {x: 7, y: 3};
    let dx = 0, dy = -1, score = 0, steps = 0;
    let particles = [];
    let lastTime = 0;

    // 誇大動態變數
    let fxScale = 1, fxBlur = 0, fxAlpha = 1;

    function move(x, y) {
        if ((x === -dx && x !== 0) || (y === -dy && y !== 0)) return;
        dx = x; dy = y;
    }

    function spawnFX(x, y, type) {
        for(let i=0; i<30; i++) {
            const angle = Math.random() * Math.PI * 2;
            const force = type === 'in' ? 60 : 2;
            particles.push({
                x: x + (type === 'in' ? Math.cos(angle) * force : 0),
                y: y + (type === 'in' ? Math.sin(angle) * force : 0),
                vx: type === 'in' ? 0 : (Math.random() - 0.5) * 15,
                vy: type === 'in' ? 0 : (Math.random() - 0.5) * 15,
                tx: x, ty: y, life: 1, type: type,
                color: Math.random() > 0.5 ? '#e60012' : '#ffffff'
            });
        }
    }

    function update() {
        if (dx === 0 && dy === 0) return;
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};

        if (head.x === eyelet.x && head.y === eyelet.y) {
            score++; steps++;
            scoreEl.innerText = score;
            const type = steps % 2 === 1 ? 'in' : 'out';
            actionEl.innerText = type === 'in' ? "鑽入 ↓" : "鑽出 ↑";
            
            // 設置誇張視覺
            if (type === 'in') { fxScale = 0.3; fxBlur = 8; fxAlpha = 0.3; }
            else { fxScale = 2.2; fxBlur = 0; fxAlpha = 1; }
            
            spawnFX(eyelet.x * ts + ts/2, eyelet.y * ts + ts/2, type);
            eyelet = {x: Math.floor(Math.random()*grid), y: Math.floor(Math.random()*grid)};
            
            canvas.style.transform = "scale(1.1) rotate(2deg)";
            setTimeout(() => canvas.style.transform = "scale(1) rotate(0deg)", 150);
        } else {
            snake.pop();
            fxScale += (1 - fxScale) * 0.2;
            fxBlur += (0 - fxBlur) * 0.2;
            fxAlpha += (1 - fxAlpha) * 0.2;
        }
        snake.unshift(head);

        particles.forEach((p, i) => {
            if (p.type === 'in') { p.x += (p.tx - p.x) * 0.2; p.y += (p.ty - p.y) * 0.2; }
            else { p.x += p.vx; p.y += p.vy; }
            p.life -= 0.04;
            if (p.life <= 0) particles.splice(i, 1);
        });
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. 畫鞋眼孔 (金屬 3D 感)
        const ex = eyelet.x * ts + ts/2, ey = eyelet.y * ts + ts/2;
        ctx.shadowBlur = 15; ctx.shadowColor = "black";
        ctx.fillStyle = "#111"; ctx.beginPath(); ctx.arc(ex, ey, ts/2, 0, 7); ctx.fill();
        ctx.strokeStyle = "#d4af37"; ctx.lineWidth = 4; ctx.stroke();
        ctx.shadowBlur = 0;

        // 2. 畫鞋帶 (Snake)
        snake.forEach((p, i) => {
            ctx.save();
            const isHead = i === 0;
            const s = isHead ? fxScale : 1;
            ctx.filter = isHead ? `blur(${fxBlur}px)` : 'none';
            ctx.globalAlpha = isHead ? fxAlpha : 1;
            
            ctx.translate(p.x * ts + ts/2, p.y * ts + ts/2);
            ctx.scale(s, s);

            // 鞋帶質感 (漸層+紋理)
            let g = ctx.createLinearGradient(-ts/2, -ts/2, ts/2, ts/2);
            g.addColorStop(0, "#e60012"); g.addColorStop(1, "#80000a");
            ctx.fillStyle = g;
            ctx.beginPath(); ctx.roundRect(-ts/2+1, -ts/2+1, ts-2, ts-2, 6); ctx.fill();
            
            // 織帶斜紋
            ctx.strokeStyle = "rgba(255,255,255,0.15)"; ctx.lineWidth = 2;
            for(let j=-ts; j<ts; j+=5) {
                ctx.beginPath(); ctx.moveTo(j, -ts/2); ctx.lineTo(j+ts, ts/2); ctx.stroke();
            }
            ctx.restore();
        });

        // 3. 畫粒子
        particles.forEach(p => {
            ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
            ctx.beginPath(); ctx.arc(p.x, p.y, 4 * p.life, 0, 7); ctx.fill();
        });
        ctx.globalAlpha = 1;
    }

    function gameLoop(now) {
        requestAnimationFrame(gameLoop);
        if (now - lastTime < 180) return;
        lastTime = now;
        
        const h = snake[0];
        if (h.x<0 || h.x>=grid || h.y<0 || h.y>=grid || snake.slice(1).some(p=>p.x===h.x && p.y===h.y)) {
            alert("撞牆啦！穿孔數: " + score);
            location.reload();
        } else { update(); draw(); }
    }
    requestAnimationFrame(gameLoop);
</script>
</body>
</html>
