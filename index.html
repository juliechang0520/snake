<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paiho Shoelace Adventure</title>
    <style>
        :root {
            --paiho-red: #e60012;
            --paiho-black: #1a1a1a;
            --shoe-fabric: #34495e; /* 模擬鞋面深色布料 */
            --btn-bg: #2c3e50;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 100vh;
            margin: 0;
            background: radial-gradient(circle, #2c3e50 0%, #000000 100%);
            font-family: "Segoe UI", Roboto, sans-serif;
            color: white;
            overflow: hidden;
        }

        .header {
            padding: 15px 0;
            text-align: center;
            width: 100%;
        }

        .brand-logo {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 2px;
            color: var(--paiho-red);
            text-shadow: 0 0 15px rgba(230,0,18,0.5);
        }

        .status-panel {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 8px;
        }

        .tag {
            background: rgba(255,255,255,0.1);
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 13px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* 遊戲區域 */
        #game-box {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        canvas {
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8), inset 0 0 100px rgba(0,0,0,0.2);
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAS0lEQVQ4T2P8////fwYKAOOo4VCG8f///0diI5uB8f///0mOZAaiGfD///9kRjID0Qz4//8/siOZwYhmoP8Z6H8GCgaDGQxmgL7OABM5S6HeDkYpAAAAAElFTkSuQmCC'); /* 模擬鞋面紋理 */
            background-color: var(--shoe-fabric);
        }

        /* 3D 擬真控制區 */
        .pad-container {
            padding-bottom: 40px;
            display: grid;
            grid-template-columns: repeat(3, 70px);
            gap: 15px;
        }

        .joy-btn {
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #32465a, #2b3a4a);
            border: none;
            border-radius: 18px;
            color: #bdc3c7;
            font-size: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 8px 8px 16px #1a252f, -8px -8px 16px #3e5771; /* Neumorphism */
            transition: all 0.1s;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .joy-btn:active {
            box-shadow: inset 5px 5px 10px #1a252f, inset -5px -5px 10px #3e5771;
            transform: scale(0.95);
            color: var(--paiho-red);
        }

        .up { grid-column: 2; }
        .left { grid-column: 1; }
        .down { grid-column: 2; }
        .right { grid-column: 3; }
    </style>
</head>
<body>

    <div class="header">
        <div class="brand-logo">PAIHO ADVENTURE</div>
        <div class="status-panel">
            <div class="tag">EYELETS: <span id="score">0</span></div>
            <div class="tag">ACTION: <span id="action" style="color:var(--paiho-red)">START!</span></div>
        </div>
    </div>

    <div id="game-box">
        <canvas id="gameCanvas"></canvas>
    </div>

    <div class="pad-container">
        <button class="joy-btn up" onclick="control(0, -1)">▲</button>
        <button class="joy-btn left" onclick="control(-1, 0)">◀</button>
        <button class="joy-btn down" onclick="control(0, 1)">▼</button>
        <button class="joy-btn right" onclick="control(1, 0)">▶</button>
    </div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const actionEl = document.getElementById("action");

    const size = Math.min(window.innerWidth * 0.9, window.innerHeight * 0.45);
    canvas.width = size;
    canvas.height = size;

    const grid = 16;
    const ts = canvas.width / grid;

    // 初始位置調整，避免開局碰撞
    let snake = [{x: 8, y: 12}, {x: 8, y: 13}, {x: 8, y: 14}];
    let food = {x: 8, y: 5};
    let dx = 0, dy = -1; // 預設向上移動
    let score = 0, steps = 0;
    let frameTime = 0;
    const speed = 220;

    // 動態變數
    let currentScale = 1;
    let currentAlpha = 1;
    let isZIn = true; // 是否為穿入狀態

    function loop(t) {
        requestAnimationFrame(loop);
        if (t - frameTime < speed) return;
        frameTime = t;

        if (checkHit()) {
            alert("遊戲結束！穿孔次數: " + score);
            reset();
            return;
        }
        update();
        draw();
    }

    function update() {
        const head = {x: snake[0].x + dx, y: snake[0].y + dy};
        snake.unshift(head);

        if (head.x === food.x && head.y === food.y) {
            score++;
            steps++;
            scoreEl.innerText = score;
            
            // 穿孔動態邏輯切換
            isZIn = steps % 2 === 1;
            if (isZIn) {
                actionEl.innerText = "穿入孔洞 ↓";
                currentScale = 0.5;
                currentAlpha = 0.4;
            } else {
                actionEl.innerText = "穿出孔洞 ↑";
                currentScale = 1.5;
                currentAlpha = 1.0;
            }
            spawnFood();
        } else {
            snake.pop();
            currentScale = 1;
            currentAlpha = 1;
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. 畫鞋眼孔 (可以看透的孔洞)
        const fx = food.x * ts + ts/2;
        const fy = food.y * ts + ts/2;
        
        // 孔洞外框
        ctx.strokeStyle = "#95a5a6";
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.arc(fx, fy, ts/2, 0, Math.PI*2);
        ctx.stroke();

        // 孔洞內部 (陰影遮罩感)
        ctx.fillStyle = "rgba(0,0,0,0.6)";
        ctx.beginPath();
        ctx.arc(fx, fy, ts/2.2, 0, Math.PI*2);
        ctx.fill();

        // 2. 畫鞋帶 (加強織紋紋理)
        snake.forEach((p, i) => {
            const isHead = i === 0;
            const s = isHead ? currentScale : 1;
            const a = isHead ? currentAlpha : 1;
            const offset = (ts * (1 - s)) / 2;

            ctx.save();
            ctx.globalAlpha = a;
            ctx.translate(p.x * ts + offset, p.y * ts + offset);
            
            // 鞋帶主體
            ctx.fillStyle = varColor(isHead);
            ctx.beginPath();
            ctx.roundRect(0, 0, ts * s, ts * s, 5);
            ctx.fill();

            // 繪製強化的織紋紋理 (斜線紋路)
            ctx.strokeStyle = "rgba(255,255,255,0.3)";
            ctx.lineWidth = 1.5;
            for(let j=0; j<ts*s; j+=5) {
                ctx.beginPath();
                ctx.moveTo(j, 0);
                ctx.lineTo(0, j);
                ctx.stroke();
            }
            
            ctx.restore();
        });
    }

    function varColor(head) {
        return head ? "#e60012" : "#c0392b";
    }

    function control(x, y) {
        if ((x === -dx && x !== 0) || (y === -dy && y !== 0)) return;
        dx = x; dy = y;
    }

    function checkHit() {
        const h = snake[0];
        if (h.x<0 || h.x>=grid || h.y<0 || h.y>=grid) return true;
        for (let i=1; i<snake.length; i++) {
            if (snake[i].x === h.x && snake[i].y === h.y) return true;
        }
        return false;
    }

    function spawnFood() {
        food = {x: Math.floor(Math.random()*grid), y: Math.floor(Math.random()*grid)};
        if (snake.some(p => p.x === food.x && p.y === food.y)) spawnFood();
    }

    function reset() {
        score = 0; steps = 0; dx = 0; dy = -1;
        snake = [{x: 8, y: 12}, {x: 8, y: 13}, {x: 8, y: 14}];
        actionEl.innerText = "RESTART!";
        spawnFood();
    }

    spawnFood();
    requestAnimationFrame(loop);
</script>
</body>
</html>
