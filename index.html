<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‹å¸¶ç©¿å­”ï¼šç‰©ç†ç©¿æ¢­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }
        #game-container { position: relative; }
        canvas { border: 12px solid #1e293b; border-radius: 30px; box-shadow: 0 35px 60px -15px rgba(0, 0, 0, 0.7); }
        #game-over {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.95); display: none;
            flex-direction: column; align-items: center; justify-content: center;
            border-radius: 18px; z-index: 50; backdrop-filter: blur(8px);
        }
        .mode-tag { padding: 8px 20px; border-radius: 99px; font-weight: 800; font-size: 0.8rem; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.1em; }
        .player-active { background: #ef4444; color: white; }
        .auto-active { background: #3b82f6; color: white; animation: pulse 0.8s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div class="mb-6 text-center">
        <div id="statusTag" class="mode-tag player-active mb-4">ç©å®¶ï¼šåœ°è¡¨ç§»å‹•</div>
        <div class="text-white text-6xl font-black italic tracking-tighter" id="score">0</div>
    </div>

    <div id="game-container">
        <div id="game-over">
            <h1 class="text-white text-5xl font-black mb-2">GAME OVER</h1>
            <button onclick="location.reload()" class="px-10 py-4 bg-white text-slate-900 font-black rounded-full shadow-2xl uppercase tracking-widest mt-4">Restart</button>
        </div>
        <canvas id="laceCanvas" width="600" height="600"></canvas>
    </div>

    <script>
        const canvas = document.getElementById("laceCanvas");
        const ctx = canvas.getContext("2d");
        const scoreEl = document.getElementById("score");
        const statusEl = document.getElementById("statusTag");

        const box = 40; 
        const eyeletR = 20;
        let score = 0;
        let isAutoMode = false;
        let isGameOver = false;
        
        let snake = [{ x: 7 * box, y: 7 * box }];
        let d = "RIGHT";
        let targetHole = { x: 3 * box, y: 3 * box };
        let pathHistory = [];

        // ğŸ¨ å¸†å¸ƒèƒŒæ™¯
        function drawCanvasTexture() {
            ctx.fillStyle = "#253347"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = "rgba(255,255,255,0.03)";
            for(let i=0; i<canvas.width; i+=4) {
                ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, canvas.height); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke();
            }
        }

        // ğŸ‘Ÿ ç¹ªè£½å…¨ç´…ç¹”å¸¶
        function drawLace(x, y, isVisible) {
            if (!isVisible) return;
            ctx.save();
            ctx.fillStyle = "#cc0000"; // æ•´æ¢ç´…è‰²
            ctx.shadowBlur = isAutoMode ? 0 : 8;
            ctx.shadowColor = "rgba(0,0,0,0.5)";
            ctx.beginPath();
            ctx.roundRect(x+2, y+2, box-4, box-4, 4);
            ctx.fill();

            // å‚ç›´/æ°´å¹³ç·¨ç¹”ç´‹è·¯ (æ·±è‰²ç´…ç·š)
            ctx.strokeStyle = "#880000";
            ctx.lineWidth = 3;
            ctx.beginPath(); ctx.moveTo(x+box/2, y+4); ctx.lineTo(x+box/2, y+box-4); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(x+4, y+box/2); ctx.lineTo(x+box-4, y+box/2); ctx.stroke();
            ctx.restore();
        }

        function drawEyelet(x, y, isTarget) {
            const cx = x + box/2, cy = y + box/2;
            ctx.save();
            let g = ctx.createRadialGradient(cx-5, cy-5, 2, cx, cy, eyeletR);
            g.addColorStop(0, "#f8fafc"); g.addColorStop(1, "#475569");
            ctx.fillStyle = g;
            ctx.beginPath(); ctx.arc(cx, cy, eyeletR, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "#0f172a"; 
            ctx.beginPath(); ctx.arc(cx, cy, eyeletR-7, 0, Math.PI*2); ctx.fill();
            ctx.restore();
        }

        function changeDir(newDir) {
            if (isAutoMode || isGameOver) return;
            if (newDir === "LEFT" && d !== "RIGHT") d = "LEFT";
            else if (newDir === "UP" && d !== "DOWN") d = "UP";
            else if (newDir === "RIGHT" && d !== "LEFT") d = "RIGHT";
            else if (newDir === "DOWN" && d !== "UP") d = "DOWN";
        }

        window.addEventListener("keydown", e => {
            if (e.keyCode === 37) changeDir("LEFT");
            if (e.keyCode === 38) changeDir("UP");
            if (e.keyCode === 39) changeDir("RIGHT");
            if (e.keyCode === 40) changeDir("DOWN");
        });

        function update() {
            if (isGameOver) return;
            let hX = snake[0].x, hY = snake[0].y;

            if (isAutoMode) {
                // è‡ªå‹•æ¨¡å¼ï¼šç§»å‹•åˆ°éš¨æ©Ÿä¸‹ä¸€å€‹å­”æ´
                if (hX < targetHole.x) hX += box;
                else if (hX > targetHole.x) hX -= box;
                else if (hY < targetHole.y) hY += box;
                else if (hY > targetHole.y) hY -= box;

                if (hX === targetHole.x && hY === targetHole.y) {
                    isAutoMode = false;
                    statusEl.innerText = "ç©å®¶ï¼šåœ°è¡¨ç§»å‹•";
                    statusEl.className = "mode-tag player-active";
                    targetHole = {
                        x: Math.floor(Math.random() * (canvas.width/box)) * box,
                        y: Math.floor(Math.random() * (canvas.height/box)) * box
                    };
                }
            } else {
                if (d === "LEFT") hX -= box; if (d === "UP") hY -= box;
                if (d === "RIGHT") hX += box; if (d === "DOWN") hY += box;

                if (hX < 0 || hX >= canvas.width || hY < 0 || hY >= canvas.height) return endGame();
                for (let p of pathHistory) if (hX === p.x && hY === p.y) return endGame();

                if (hX === targetHole.x && hY === targetHole.y) {
                    score++; scoreEl.innerText = score;
                    isAutoMode = true;
                    statusEl.innerText = "åœ°ä¸‹ï¼šè‡ªå‹•ç©¿æ¢­";
                    statusEl.className = "mode-tag auto-active";
                    pathHistory = []; 
                } else {
                    pathHistory.push({x: hX, y: hY});
                    if (pathHistory.length > 10) pathHistory.shift();
                }
            }
            snake.unshift({x: hX, y: hY});
            if (snake.length > 12) snake.pop();
        }

        function draw() {
            drawCanvasTexture();
            drawEyelet(targetHole.x, targetHole.y, true);

            snake.forEach((s, i) => {
                // é—œéµå‹•æ…‹åˆ¤å®šï¼š
                // 1. åœ¨è‡ªå‹•æ¨¡å¼æ™‚ï¼Œèº«é«”ç¯€é»å¦‚æœé‚„æ²’åˆ°é”ç›®æ¨™å­”æ´ï¼Œå°±ä¸é¡¯ç¤º (æ¨¡æ“¬å¾å­”æ´é‘½å‡º)
                // 2. åœ¨ç©å®¶æ¨¡å¼æ™‚ï¼Œç•¶è›‡é ­é€²å…¥å­”æ´ï¼Œå¾Œé¢çš„èº«é«”ç§»å‹•åˆ°å­”æ´å¾Œæ¶ˆå¤± (æ¨¡æ“¬é‘½å…¥å­”æ´)
                let isVisible = true;
                if (isAutoMode) {
                    // è‡ªå‹•æ¨¡å¼ä¸‹ï¼Œåªæœ‰é ­éƒ¨é¡¯ç¤ºï¼Œæ¨¡æ“¬æ­£åœ¨ç©¿æ¢­ï¼Œèº«é«”ç•™åœ¨ã€ŒèˆŠå­”æ´ã€æ¶ˆå¤±äº†
                    isVisible = (i === 0); 
                }
                
                // ç¹ªè£½ç¹”å¸¶ (æ•´æ¢ç´…è‰²)
                drawLace(s.x, s.y, isVisible);
            });
        }

        function endGame() {
            isGameOver = true;
            document.getElementById("game-over").style.display = "flex";
        }

        function loop() {
            update();
            draw();
            setTimeout(loop, isAutoMode ? 60 : 200);
        }
        loop();
    </script>
</body>
</html>
